<div class="breadcrumb" style="margin-bottom: 10px !important;">
  <h1 class="pull-left">Visits</h1>
  <input type="text" placeholder="Search by client name, phone, email, reference number,office" [formControl]="searchControl" class="form-control form-control-rounde pull-left w-50 ml-1" [(ngModel)]="search">
  <button class="btn btn-info btn-icon"><i class="i-Filter-2"></i></button>
  <div class="btn-group btn-group-toggle pull-right" data-toggle="buttons">
    <div class="btn-group btn-group-toggle" ngbRadioGroup name="radioBasic" [(ngModel)]="status" (ngModelChange)="loadEvents()">
      <label ngbButtonLabel class="btn btn-secondary">
        <input ngbButton type="radio" value="Scheduled"> Scheduled
      </label>
      <label ngbButtonLabel class="btn btn-secondary">
        <input ngbButton type="radio" value="Visited"> Visited
      </label>
    </div>
  </div>
  <div class="clear"></div>
</div>
<div class="card">
  <div class="">
    <div class="p-3 d-flex justify-content-between align-items-center calendar-title">
      <!-- Arrow navigations -->
      <div class="cal-top-col text-center">
        <button class="btn btn-rounded btn-icon btn-outline-primary m-1" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate" (click)="loadEvents()">
          <i class="i-Arrow-Left"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-primary m-1" mwlCalendarToday [(viewDate)]="viewDate">
          <i class="i-Calendar-2"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-outline-primary m-1" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate" (click)="loadEvents()">
          <i class="i-Arrow-Right"></i>
        </button>
      </div>
      <!-- Date title -->
      <div class=" text-center">
        <h5 class="m-0 text-muted font-weight-bold">{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h5>
      </div>
      <!-- Month, day, week view toggle buttons -->
      <div class="d-flex justify-content-center">
        <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'month'" [class.active]="view === 'month'" ngbTooltip="Month view" (click)="loadEvents()">
          <i class="i-Calendar"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'week'" [class.active]="view === 'week'" ngbTooltip="Week view" (click)="loadEvents()">
          <i class="i-Split-Vertical-2"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'day'" [class.active]="view === 'day'" ngbTooltip="Day view" (click)="loadEvents()">
          <i class="i-Align-Justify-All"></i>
        </button>
      </div>
    </div>
    <!-- <mat-divider></mat-divider> -->
  </div>
  <!-- Calendar -->
  <div class="p-0">
    <div [ngSwitch]="view">
      <mwl-calendar-month-view *ngSwitchCase="'month'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="dayClicked($event.day)" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-month-view>
      <mwl-calendar-week-view *ngSwitchCase="'week'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-week-view>
      <mwl-calendar-day-view *ngSwitchCase="'day'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-day-view>
    </div>
  </div>
</div>
<ng-template #visitModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Visit Schedule</h4>
    <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
      <ngb-panel>
        <ng-template ngbPanelTitle>
          <span class="pull-left d-ib f-b fs-14">Lead Basic Data</span>
        </ng-template>
        <ng-template ngbPanelContent>
          <div class="row p-0">
            <div class="col-md-10 col-6 mb-2">
              <p class="text-muted mb-0">Office & Location</p>
              <span class="f-b">{{visit?.office?.name}} , {{visit?.location}}</span>
            </div>
            <div class="col-md-2 col-6 mb-2">
              <p class="text-muted mb-0">Visit Status </p>
              <span class="f-b">{{visit?.status}}</span>
            </div>
            <div class="col-md-3 col-6 mb-2">
              <p class="text-muted mb-0">Lead Company </p>
              <span class="f-b">{{visit?.lead?.companyName}}</span>
            </div>
            <div class="col-md-3 col-12 mb-2">
              <p class="text-muted mb-0">Contact Name</p>
              <span class="f-b">{{visit?.lead?.name}}</span>
            </div>
            <div class="col-md-3 col-12 mb-2">
              <p class="text-muted mb-0">Email</p>
              <span class="f-b">{{visit?.lead?.email}}</span>
            </div>
            <div class="col-md-3 col-12 mb-2">
              <p class="text-muted mb-0">Phone</p>
              <span class="f-b">{{visit?.lead?.phone}}</span>
              <span class=""><button class="btn btn-outline-info btn-icon" ngbTooltip="Click to Call" (click)="callNow(visit?.client.phone)"><i class="fa fa-phone"></i></button></span>
            </div>
          </div>
        </ng-template>
      </ngb-panel>
      <ngb-panel>
        <ng-template ngbPanelTitle>
          <span class="pull-left d-ib f-b fs-14">Visit Details</span>
        </ng-template>
        <ng-template ngbPanelContent>
          <div class="row p-0">
            <div class="col-md-4 col-12 mb-2">
              <p class="text-muted mb-0">Date & Time</p>
              <span class="fs-12 f-b">{{visit?.from | date : 'MMM dd, yyyy hh:mm a'}}</span>
            </div>
            <div class="col-md-4 col-12 mb-2">
              <p class="text-muted mb-0">Assigned To:</p>
              <span class="badge badge-warning fs-12" *ngIf="!visit.assigned?.name">Not yet assigned</span>
              <span class="badge badge-success fs-12" *ngIf="visit.assigned?.name">{{visit.assigned?.name}}</span>
            </div>
          </div>
        </ng-template>
      </ngb-panel>
    </ngb-accordion>
  </div>
  <div class="modal-footer">
    <form *ngIf="revisit" class="d-ib w-100">
      <div class="form-group float-left d-ib">
        <label for="roles"> Date</label>
        <input placeholder="Select Revisit Date" class="form-control" name="dp" ngbDatepicker #dp="ngbDatepicker" [(ngModel)]="visit.forDate" [ngModelOptions]="{standalone: true}" (focus)="dp.toggle()" />
      </div>
      <div class="form-group float-left d-ib">
        <label for="roles">Time</label>
        <input type="time" placeholder="Select start time" class="form-control" name="dp" [(ngModel)]="visit.startTime" [ngModelOptions]="{standalone: true}" />
      </div>
      <div class="form-group float-left d-ib" style="width: 300px;">
        <button class="btn btn-info btn-ico mt-4 ml-1" (click)="rescheduleVisit()"><i class="fa fa-check"></i> Reschedule</button>
        <button class="btn btn-outline-warning btn-ico mt-4 ml-1" ngbTooltip="Cancel Revisit" (click)="revisit=false"><i class="fa fa-times"></i> Cancel</button>
      </div>
    </form>
    <button class="btn btn-secondary btn-ico" (click)="revisit=true" *ngIf="!revisit&&visit?.status=='Scheduled'">
      <i class="fa fa-refresh"></i> Reschedule Visit</button>
    <button class="btn btn-warning btn-ico" (click)="cancelVisit()" *ngIf="!revisit&&visit?.status=='Scheduled'">
      <i class="fa fa-times"></i> Cancel Visit</button>
    <button class="btn btn-info btn-ico" (click)="confirmVisit()" *ngIf="!revisit&&visit?.status=='Scheduled'">
      <i class="fa fa-check"></i> Mark as Visited</button>
    <button type="button" class="btn btn-outline-light" (click)="modal.close('close click')">Close</button>
  </div>
</ng-template>
<div class="breadcrumb" style="margin-bottom: 10px !important;">
  <h1 class="pull-left">SLA Schedules</h1>
  <!-- <input type="text" placeholder="Search by client name, phone, email, reference number,office" [formControl]="searchControl" class="form-control form-control-rounde pull-left w-50 ml-1" [(ngModel)]="search"> -->
  <!-- <button class="btn btn-info btn-icon"><i class="i-Filter-2"></i></button> -->
  <!--   <div class="btn-group btn-group-toggle pull-right" data-toggle="buttons">
    <div class="btn-group btn-group-toggle" ngbRadioGroup name="radioBasic" [(ngModel)]="type" (ngModelChange)="loadEvents()">
      <label ngbButtonLabel class="btn btn-sm btn-secondary">
        <input ngbButton type="radio" value="OnBoarding"> OnBoardings
      </label>
      <label ngbButtonLabel class="btn btn-sm btn-secondary">
        <input ngbButton type="radio" value="Exit"> Exits
      </label>
    </div>
  </div> -->
  <div class="clear"></div>
</div>
<div class="card">
  <div class="">
    <div class="p-3 d-flex justify-content-between align-items-center calendar-title">
      <!-- Arrow navigations -->
      <div class="cal-top-col text-center">
        <button class="btn btn-rounded btn-icon btn-outline-primary m-1" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate" (click)="loadEvents()">
          <i class="i-Arrow-Left"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-primary m-1" mwlCalendarToday [(viewDate)]="viewDate">
          <i class="i-Calendar-2"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-outline-primary m-1" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate" (click)="loadEvents()">
          <i class="i-Arrow-Right"></i>
        </button>
      </div>
      <!-- Date title -->
      <div class=" text-center">
        <h5 class="m-0 text-muted f-b">{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h5>
      </div>
      <!-- Month, day, week view toggle buttons -->
      <div class="d-flex justify-content-center">
        <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'month'" [class.active]="view === 'month'" ngbTooltip="Month view" (click)="loadEvents()">
          <i class="i-Calendar"></i>
        </button>
        <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'week'" [class.active]="view === 'week'" ngbTooltip="Week view" (click)="loadEvents()">
          <i class="i-Split-Vertical-2"></i>
        </button>
        <!--  <button class="btn btn-rounded btn-icon btn-primary m-1" (click)="view = 'day'" [class.active]="view === 'day'" ngbTooltip="Day view" (click)="loadEvents()">
          <i class="i-Align-Justify-All"></i>
        </button> -->
      </div>
    </div>
    <!-- <mat-divider></mat-divider> -->
  </div>
  <!-- Calendar -->
  <div class="p-0">
    <div [ngSwitch]="view">
      <mwl-calendar-month-view *ngSwitchCase="'month'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="dayClicked($event.day)" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-month-view>
      <mwl-calendar-week-view *ngSwitchCase="'week'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-week-view>
      <mwl-calendar-day-view *ngSwitchCase="'day'" [viewDate]="viewDate" [events]="events" [refresh]="refresh" (eventClicked)="handleEvent('edit', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-day-view>
    </div>
  </div>
</div>
<ng-template #ticketModal let-modal>
  <loading [loading]="loading"></loading>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Ticket View - {{ticket.refNo}} - <small>{{ticket.assigned?.name ? 'Assigned to ' + ticket.assigned?.name : 'UnAssigned'}}</small> &nbsp; </h4>
    <span *ngIf="ticket.status=='New'" class="badge badge-primary float-right">New</span>
    <span *ngIf="ticket.status=='Attended'" class="badge badge-info float-right">Attended</span>
    <span *ngIf="ticket.status=='Resolved'" class="badge badge-success float-right">Resolved</span>
    <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row p-0">
      <div class="col-md-3 col-6 mb-2">
        <p class="text-muted mb-0">Company </p>
        <span class="f-b">{{ticket.booking?.client.company}}</span>
      </div>
      <div class="col-md-3 col-12 mb-2">
        <p class="text-muted mb-0">Contact Name</p>
        <span class="f-b">{{ticket.booking?.client.name}}</span>
      </div>
      <div class="col-md-3 col-12 mb-2">
        <p class="text-muted mb-0">Email</p>
        <span class="f-b">{{ticket.booking?.client.email}}</span>
      </div>
      <div class="col-md-3 col-12 mb-2">
        <p class="text-muted mb-0">Phone</p>
        <span class="f-b">{{ticket.booking?.client.phone}}</span>
        <span class=""><button class="btn btn-outline-info btn-icon" ngbTooltip="Click to Call" (click)="callNow(ticket.booking?.client.phone)"><i class="fa fa-phone"></i></button></span>
      </div>
    </div>
    <div class="row mb-2 border-bottom border-top pt-1 pb-2">
      <div class="" [ngClass]="{'col-md-9':ticket.attachments.length>0,'col-md-12':ticket.attachments.length==0}">
        <div class="font-12"><strong>{{ticket.issue}}</strong></div>
        <div class="font-12">{{ticket.description}}</div>
      </div>
      <div class="col-md-3" *ngIf="ticket.attachments.length>0">
        <div class="lb-i text-muted">Attachments</div>
        <p *ngFor="let attachment of ticket.attachments;"><a [href]="attachment.file" target="_blank">{{attachment.name}}</a></p>
      </div>
    </div>
    <form [formGroup]="messageForm" class="row">
      <div class="col-md-10 form-group mb-1">
        <label for="roles">Reply to Ticket</label>
        <textarea placeholder="Enter your Message here " rows=5 class="form-control" name="comment" [(ngModel)]="message" formControlName="comment"></textarea>
      </div>
      <div class="col-md-2 form-group mb-1 pt-4 pl-0">
        <button class="float-right btn btn-sm btn-primary mt-4 btn-ico" [disabled]="messageForm.invalid" (click)="saveTicketMessage()"><i class="fa fa-check"></i> Send Message</button>
      </div>
    </form>
  </div>
  <div class="modal-footer d-b">
    <a class="btn btn-outline-info btn-ico btn-sm float-left" [href]="'#/bookings/view/' + ticket.bookingId" target="_blank"><i class="fa fa-search"></i> View Booking</a>
    <button type="button" class="float-right btn btn-outline-light" (click)="modal.close('close click')">Close</button>
    <button class="float-right btn btn-outline-primary btn-sm ml-10 btn-ico" *ngIf="ticket.assigned?.id &&  ticket.status=='New'" (click)="changeStatus('Attended')" tooltip="Mark as Attended">
      <i class="fa fa-check"></i> Attended
    </button>
    <button class="float-right btn btn-outline-info btn-sm ml-10 btn-ico" *ngIf="ticket.status!='Resolved' && ticket.status!='New'&& ticket.status!='Closed'" tooltip="Mark as Resolved" (click)="changeStatus('Resolved')">
      <i class="fa fa-thumbs-up"></i> Resolved
    </button>
    <button class="float-right btn btn-outline-success btn-sm ml-10 btn-ico" tooltip="Mark as Closed" *ngIf="ticket.status=='Resolved'" (click)="changeStatus('Closed')">
      <i class="fa fa-stop"></i> Closed
    </button>
  </div>
</ng-template>
<div class="">
  <div class="breadcrumb row">
    <h1 class="d-ib col-md-2 float-left">Bookings
      <help-notes [context]="'Booking:OfficeBookingStatusFlow'" [type]="'popup'" [placement]="'bottom'" class="float-right  ml-10"></help-notes>
      <help-notes [context]="'Booking:OfficeBookingStatusDefinition'" [type]="'popup'" [placement]="'bottom'" class="float-right  ml-10"></help-notes>
    </h1>
    <div class="d-ib col-md-4 float-left">
      <input type="text" placeholder="Search by client name, phone, email, reference number, location, city" [formControl]="searchControl" class="form-control form-control-rounde w-90 float-left">
      <!-- <button class="btn btn-info btn-icon float-right"><i class="i-Filter-2"></i></button> -->
      <button class="btn btn-outline-primary btn-icon float-right" ngbTooltip="Quick Filters" *ngIf="!moreFilters" (click)="moreFilters=true;loadBuildingBookings()"><i class="fa fa-caret-square-o-down"></i></button>
      <button class="btn btn-outline-primary btn-icon float-right" ngbTooltip="Hide Filters" *ngIf="moreFilters" (click)="moreFilters=false;"><i class="fa fa-caret-square-o-up"></i></button>
    </div>
    <div class="d-ib col-md-4 float-left">
      <ng-select class="w-90" [items]="['New','Booked','Active','Exiting','Exited','TDSHolded','Settled','Cancelled']" [multiple]="true" [closeOnSelect]="false" [hideSelected]="true" placeholder="Select Statuses" [(ngModel)]="filter.statuses" [ngModelOptions]="{standalone: true}" (ngModelChange)="resetList()"></ng-select>
    </div>
    <button class="mb-2 d-ib col-md-2 col-6 btn btn-outline-primar btn-primary btn-rounde btn-ico pull-right" (click)="newBooking()" *checkAccess="'bookings:newBooking'">
      <i class="fa fa-plus"></i> Booking
    </button>
    <div class="clear"></div>
  </div>
  <div class="row" *ngIf="moreFilters">
    <div class="col-md-3">
      <label class="fs-10 mb-0">Exclude</label>
      <ng-select [items]="['New','Booked','Active','Exiting','Exited','TDSHolded','Settled','Cancelled']" [multiple]="true" [closeOnSelect]="false" [hideSelected]="true" placeholder="Exclude Statuses" [(ngModel)]="filter.excludeStatuses" [ngModelOptions]="{standalone: true}" (ngModelChange)="resetList()"></ng-select>
    </div>
    <div class="col-md-3">
      <label class="fs-10 mb-0">Product Type</label>
      <ng-select [items]="['PrivateOffice', 'EnterpriseOffice', 'VirtualOffice']" [multiple]="true" [closeOnSelect]="false" [hideSelected]="true" placeholder="Product Type" [(ngModel)]="filter.deskType" [ngModelOptions]="{standalone: true}" (ngModelChange)="resetList()"></ng-select>
    </div>
    <div class="col-md-3">
      <label class="fs-10 mb-0">Contract Kind</label>
      <ng-select [items]="['NewBooking', 'Expansion', 'Renewal', 'ReLocation', 'Contraction']" [multiple]="true" [closeOnSelect]="false" [hideSelected]="true" placeholder="Product Type" [(ngModel)]="filter.contractKind" [ngModelOptions]="{standalone: true}" (ngModelChange)="resetList()"></ng-select>
    </div>
    <div class="col-md-3">
      <label class="fs-10 mb-0">Contract Term</label>
      <ng-select [items]="['LongTerm', 'ShortTerm']" [multiple]="true" [closeOnSelect]="false" [hideSelected]="true" placeholder="Product Type" [(ngModel)]="filter.contractTerm" [ngModelOptions]="{standalone: true}" (ngModelChange)="resetList()"></ng-select>
    </div>
    <div class="col-md-9 pt-2">
      <span class="badge fs-12 mr-2">Total: <span class="m-0 text-primary">{{totalBuildingWiseBookings}}</span></span>
      <span class="badge fs-12 mr-2 cursor" *ngFor="let building of buildingBookings;" [ngClass]="{'badge-outline-primary':selectedBuilding?.id!=building?.id,'badge-primary':selectedBuilding?.id==building?.id}" (click)="selectBuilding(building)">{{building?.name}} ({{building?.count}})</span>
    </div>
  </div>
  <div class="separator-breadcrumb border-top mb-3"></div>
  <div class="clear"></div>
  <div class="list-horizontal tableBodyScroll" infiniteScroll (onScroll)="loadMore()" style="overflow:auto;max-height: calc(100vh - 140px);padding-top: 20px;margin-top: -10px;">
    <!-- SINGLE LIST ITEM -->
    <loading [loading]="loading"></loading>
    <div *ngFor="let item of items;let i=index" class="list-item col-md-12">
      <div class="card mb-2 d-flex flex-row">
        <div class="flex-grow-1 d-flex">
          <div class="card-body align-self-center pl-2 d-flex flex-column justify-content-between align-items-lg-center flex-lg-row p-1">
            <a href="#/bookings/view/{{item.id}}" class="w-35 w-sm-100">
              <div class="item-title">{{item.client?.company || item.client?.name}}</div>
              <span class="m-0 text-secondary text-small">{{item.refNo}}</span>
              <div class="mr-20 text-secondary text-small">Rent: <span class="m-0 text-primary">{{item.contract?.rent | inr}}</span> | SD: <span class="m-0 text-primary">{{item.contract?.security | inr}}</span></div>              
            </a>
            <div class="m-0 text-muted text-small w-20 w-sm-100">
              <!-- <div class="text-primary"><i class="i-Building"></i>{{(formatDate((item.invoices[0]?.startDate),'yyyy-MM-dd','en_US') < formatDate((2023-10-12),'yyyy-MM-dd','en_US'))?'True':'False'}}</div> -->
              <!-- <div class="text-primary"><i class="i-Building badge" [ngClass]="{'badge-success':(item.invoices[0]?.startDate) >= ('2023-10-01')}"></i>{{(item.invoices[0]?.startDate) >= ('2024-03-01')?'Mar : &#9989;':'Mar : &#10060;'}}</div> -->
              <div class="text-primary"><i class="i-Building"></i>{{item.contract.kind}}</div>
              <div class="text-primary"><i class="i-Building"></i>{{item.contract.term}}</div>
              <span class="text-secondary"><i class="i-Building"></i>Invoices: <span class="m-0 text-primary">{{item.invoices.length}}</span></span>
            </div>
            <div class="m-0 text-muted text-small w-20 w-sm-100">
              <div class="text-primary"><i class="i-Building"></i>{{item.office.building.name}}, {{item.offices}}</div>
              <div class="text-primary"><i class="i-Building"></i>{{item.contract.deskType}}</div>
              <span class="text-secondary">Cabins - {{item.cabins}}, Desks - {{item.desks}}</span>
            </div>
            <div class="m-0 text-muted text-small w-15 w-sm-100">
              <div class="d-b text-primary"> <span class="text-secondary">E :</span> {{item.contract?.effectiveDate | date : 'MMM dd, yyyy'}}</div>
              <div class="d-b text-primary"> <span class="text-secondary">R :</span> {{item.reserved | date : 'MMM dd, yyyy'}}</div>
              <span class="d-b text-info"> <span class="text-secondary">M :</span> {{item.started | date : 'MMM dd, yyyy'}}</span>
            </div>
            <div class="m-0 text-muted text-small w-30 w-sm-100 d-b">
              <div class="w-75 float-left">
                <div class="text-primary"><i class="i-Telephone"></i> {{item.client.name}}</div>
                <div class="text-primary"><i class="i-Telephone"></i> {{item.client.phone}}</div>
                <span class="text-secondary"><i class="i-Email"></i> {{item.client.email}}</span>
              </div>
              <div class="m-0 text-muted text-small w-20 item-actions  mr-1 ml-5 float-right">
                <div class="badge" [ngClass]="{'badge-dark':item.status=='New','badge-info':item.status=='Booked','badge-success':item.status=='Active','badge-warning':item.status=='Cancelled','badge-secondary':item.status=='Exiting','badge-light':item.status=='Exited','badge-light':item.status=='Settled'}">{{item.status}}</div>
                <a class="btn btn-icon btn-info" ngbTooltip="View Detailed Booking" target="_blank" href="#/bookings/view/{{item.id}}">
                  <i class="i-Magnifi-Glass1 text-bold"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>